
Inspecting

```
docker inspect shopping_final_0712 --format='{{.Config.Cmd}}' && echo "---" && docker inspect shopping_final_0712 --format='{{.Config.Entrypoint}}' && echo "---" && docker inspect shopping_final_0712   --format='{{.Config.ExposedPorts}}'  
docker exec shopping cat /etc/os-release
docker exec shopping ps aux
docker exec shopping php -v
docker exec shopping cat /docker-entrypoint.sh
docker exec shopping find /etc/supervisor.d/ -name "*.ini" -exec basename {} \; | sort
docker exec shopping ls -la /var/www/magento2
docker exec shopping mysql -umagentouser -pMyPassword magentodb -e "SHOW TABLES;"
docker exec shopping cat /etc/supervisord.conf
docker exec shopping cat /etc/nginx/conf.d/default.conf

docker exec shopping sh -c "find /var/www/magento2/pub/media/catalog/product -type f \\( -name '*.jpg' -o -name '*.jpeg' -o -name '*.png' -o -name '*.webp' \\)"
docker exec shopping sh -c "ls -1 /var/www/magento2/pub/media/catalog/product/*/* 2>/dev/null | wc -l"

docker exec shopping mysql -umagentouser -pMyPassword magentodb -e "SELECT value FROM catalog_product_entity_media_gallery WHERE value LIKE '%.jpg' LIMIT 5;"
docker exec shopping mysql -umagentouser -pMyPassword magentodb -e "DESCRIBE catalog_product_entity_media_gallery;"
docker exec shopping mysql -umagentouser -pMyPassword magentodb -e "SELECT DISTINCT media_type FROM catalog_product_entity_media_gallery;"

docker images shopping_final_0712 --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"
docker history shopping_final_0712 --no-trunc --format "table {{.Size}}\t{{.CreatedBy}}"

```
```
docker exec shopping rm -r /var/www/magento2/pub/media/catalog/product/cache  
docker exec shopping mkdir -p /var/www/magento2/pub/media/catalog/product/cache && docker exec shopping chown www-data:www-data /var/www/magento2/pub/media/catalog/product/cache

```
docker cp shopping:/docker-entrypoint.sh shopping_base_image/docker-entrypoint.sh && docker cp shopping:/etc/supervisor.d shopping_base_image/supervisor.d
docker cp shopping:/etc/supervisord.conf shopping_base_image/supervisord.conf
docker cp shopping:/etc/nginx/conf.d/default.conf shopping_base_image/nginx-default.conf

# slow
docker cp shopping:/var/www/magento2 shopping_extracted/


cp shopping_base_image/nginx-default.conf shopping_docker_rebuild/nginx-default.conf


> du -sh shopping_extracted/magento2/pub/media/catalog/product
5.6G    shopping_extracted/magento2/pub/media/catalog/product/B
 20G    shopping_extracted/magento2/pub/media/catalog/product/cache


> find shopping_extracted/magento2/pub/media/catalog/product/cache -type f | wc -l
1504193

> find shopping_extracted/magento2/pub/media/catalog/product/cache -name "B07HSKLBM4.1.jpg" -type f | head -10
  shopping_extracted/magento2/pub/media/catalog/product/cache/17b5a76d61f0e1c657ff3d274a36c97b/B/0/B07HSKLBM4.1.jpg
  shopping_extracted/magento2/pub/media/catalog/product/cache/473e7bb6b4efc8a3ddba70cb52a439f2/B/0/B07HSKLBM4.1.jpg
  shopping_extracted/magento2/pub/media/catalog/product/cache/02cc32c77775a78345d48d4c2526b5d2/B/0/B07HSKLBM4.1.jpg
  shopping_extracted/magento2/pub/media/catalog/product/cache/12986713d64aadbcc0bf8b8e138864b4/B/0/B07HSKLBM4.1.jpg
  shopping_extracted/magento2/pub/media/catalog/product/cache/047db8d5cd8dc1f0d997925f63b0762b/B/0/B07HSKLBM4.1.jpg
  shopping_extracted/magento2/pub/media/catalog/product/cache/01ca12655947acd9582fd990cfb065e6/B/0/B07HSKLBM4.1.jpg
  shopping_extracted/magento2/pub/media/catalog/product/cache/74cdeb509b6b4eb890697855eecec1ad/B/0/B07HSKLBM4.1.jpg
  shopping_extracted/magento2/pub/media/catalog/product/cache/44be305e826534a9d6b2afde54bb859e/B/0/B07HSKLBM4.1.jpg

  Original Image:
  - Location: shopping_extracted/magento2/pub/media/catalog/product/B/0/B07HSKLBM4.1.jpg
  - Dimensions: 1920x1080
  - Size: 589KB

  Cached Variants (same image, different sizes):
  1. 1920x1080 - 295KB (optimized version of original)
  2. 700x560 - 55KB
  3. 400x400 - 22KB
  4. 265x265 - 11KB
  5. 152x190 - 4.8KB
  6. 150x150 - 4.6KB
  7. 135x135 - 4.0KB
  8. 88x110 - 2.2KB


echo "=== ORIGINAL IMAGE ==="; identify -format "Dimensions: %wx%h\n" shopping_extracted/magento2/pub/media/catalog/product/B/0/B07HSKLBM4.1.jpg 2>/dev/null; ls -lh shopping_extracted/magento2/pub/media/catalog/product/B/0/B07HSKLBM4.1.jpg | awk '{print "File size: " $5}'
   === ORIGINAL IMAGE ===
    Dimensions: 1920x1080
    File size: 589K

````

Is cache neessary?

```

docker exec shopping mv /var/www/magento2/pub/media/catalog/product/cache /var/www/magento2/pub/media/catalog/product/cache_backup && docker exec shopping mkdir -p /var/www/magento2/pub/media/catalog/product/cache && docker exec shopping chown www-data:www-data /var/www/magento2/pub/media/catalog/product/cache

```
Lots of autogenerated tiny images. Some real ones
* in shopping_extracted/magento2/pub/media/catalog/product/B/T


Original instructions from https://github.com/web-arena-x/visualwebarena/tree/89f5af29305c3d1e9f97ce4421462060a70c9a03/environment_docker#shopping-website-onestopshop:

```
docker load --input shopping_final_0712.tar
docker run --name shopping -p 7770:80 -d shopping_final_0712
# wait ~1 min to wait all services to start

docker exec shopping /var/www/magento2/bin/magento setup:store-config:set --base-url="http://<your-server-hostname>:7770" # no trailing slash
docker exec shopping mysql -u magentouser -pMyPassword magentodb -e  'UPDATE core_config_data SET value="http://<your-server-hostname>:7770/" WHERE path = "web/secure/base_url";'
docker exec shopping /var/www/magento2/bin/magento cache:flush
ok, 
# Disable re-indexing of products
docker exec shopping /var/www/magento2/bin/magento indexer:set-mode schedule catalogrule_product
docker exec shopping /var/www/magento2/bin/magento indexer:set-mode schedule catalogrule_rule
docker exec shopping /var/www/magento2/bin/magento indexer:set-mode schedule catalogsearch_fulltext
docker exec shopping /var/www/magento2/bin/magento indexer:set-mode schedule catalog_category_product
docker exec shopping /var/www/magento2/bin/magento indexer:set-mode schedule customer_grid
docker exec shopping /var/www/magento2/bin/magento indexer:set-mode schedule design_config_grid
docker exec shopping /var/www/magento2/bin/magento indexer:set-mode schedule inventory
docker exec shopping /var/www/magento2/bin/magento indexer:set-mode schedule catalog_product_category
docker exec shopping /var/www/magento2/bin/magento indexer:set-mode schedule catalog_product_attribute
docker exec shopping /var/www/magento2/bin/magento indexer:set-mode schedule catalog_product_price
docker exec shopping /var/www/magento2/bin/magento indexer:set-mode schedule cataloginventory_stock

```



```

docker exec vwa-shopping-optimized-shopping-1 tail -5 /var/www/magento2/var/log/exception.log 2>&1 | grep -i iconv
wc -l /var/www/magento2/var/log/exception.log


```